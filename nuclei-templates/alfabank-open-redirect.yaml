id: alfabank-open-redirect

info:
  name: Alfabank/Tinkoff - Open Redirect
  author: bugbounty
  severity: medium
  description: Open redirect with strict header validation
  tags: redirect,alfabank,tinkoff
  reference:
    - https://portswigger.net/web-security/dom-based/open-redirection

http:
  - raw:
      - |
        GET /authorized?fromUrl=https://evil.com/callback HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html

      - |
        GET /password/reset?return_url=https://evil.com/reset HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html

      - |
        GET /gate/oauth/authorize?redirect_uri=https://evil.com/oauth HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 301
          - 302
          - 303
          - 307
          - 308

      - type: regex
        part: header
        regex:
          - '(?i)^Location:\s*https?://evil\.com'
        condition: and

    extractors:
      - type: kval
        name: redirect_location
        part: header
        kval:
          - Location
