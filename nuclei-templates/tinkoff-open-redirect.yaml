id: tinkoff-open-redirect

info:
  name: Tinkoff - Open Redirect via Origin Parameter
  author: bugbounty
  severity: medium
  description: Open redirect in origin parameter with header validation
  tags: redirect,tinkoff
  reference:
    - https://portswigger.net/web-security/dom-based/open-redirection

http:
  - raw:
      - |
        GET /api/common/v1/session_info?platform=web&sessionid=test&origin=https://evil.com/callback HTTP/1.1
        Host: {{Hostname}}
        Accept: application/json

    matchers-condition: and
    matchers:
      - type: regex
        part: header
        regex:
          - '(?i)^Location:\s*https?://evil\.com'
          - '(?i)^Refresh:\s*0;\s*url=https?://evil\.com'
        condition: or

      - type: status
        status:
          - 301
          - 302
          - 303
          - 307
          - 308

    extractors:
      - type: kval
        part: header
        kval:
          - Location
