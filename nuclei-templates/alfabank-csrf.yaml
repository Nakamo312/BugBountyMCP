id: alfabank-csrf

info:
  name: Alfabank - CSRF on Critical Functions
  author: bugbounty
  severity: high
  description: CSRF vulnerabilities on password reset, payment, profile update
  tags: csrf,alfabank

http:
  - raw:
      - |
        POST /password/reset HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        email=victim@test.com

      - |
        POST /rest/Init HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {"Amount":1000,"OrderId":"test123"}

      - |
        POST /manager/template/quick-update HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        type=admin&action=update

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201
          - 302

      - type: word
        part: header
        words:
          - "Set-Cookie"
        negative: true

      - type: regex
        part: body
        regex:
          - 'csrf|token|authenticity'
        negative: true
