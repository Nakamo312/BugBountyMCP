id: alfabank-ssti

info:
  name: Alfabank - Server Side Template Injection
  author: bugbounty
  severity: critical
  description: SSTI with mathematical expression evaluation
  tags: ssti,rce,alfabank
  reference:
    - https://portswigger.net/web-security/server-side-template-injection

http:
  - raw:
      - |
        GET /manager/template/quick-update?type={{7*7}} HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html,application/xhtml+xml

      - |
        GET /search/?text={{7*7}} HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html

      - |
        GET /404.html?page={{7*7}} HTTP/1.1
        Host: {{Hostname}}
        Accept: text/html

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "49"

      - type: word
        part: body
        words:
          - "{{7*7}}"
          - "{{7"
        negative: true
        condition: and

      - type: status
        status:
          - 200
          - 404
          - 500

      - type: dsl
        dsl:
          - 'contains(body, "49")'
          - '!contains(body, "{{")'
          - '!contains(body, "*")'
        condition: and
